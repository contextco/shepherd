<%= form_with model: service_object, url:, method: form_method do |form| %>
  <%= form.hidden_field :service_id, value: service_object.service_id  %>
  <div class="flex flex-col gap-6">
    <%= render UI::FormTextFieldComponent.new(title: 'Name') do |component| %>
      <%= component.with_label do %>
        Unique within the project. Must be lower case and contain only letters, numbers, and hyphens with no spaces.
      <% end %>
      <%= component.with_field do %>
        <%= form.text_field :name,
                            required: true,
                            'data-1p-ignore': true,
                            'data-lpignore': true,
                            class: 'w-full !p-0 border-0 focus:ring-0' %>
      <% end %>
    <% end %>

    <%= render UI::FormTextFieldComponent.new(title: 'Image') do |component| %>
      <%= component.with_label do %>
        Valid docker image url with version tag. <span class="font-mono">:latest</span> is not allowed.
      <% end %>
      <%= component.with_field do %>
        <%= form.text_field :image,
                            required: true,
                            placeholder: 'docker.io/library/nginx:1.24.0-alpine3.17',
                            class: 'w-full !p-0 border-0 focus:ring-0' %>
      <% end %>
    <% end %>

    <%= render UI::FormResourcesComponent.new(form:, fields: %i[cpu memory]) %>

    <%= render UI::FormMultiFieldComponent.new(
      title: 'Environment Variables',
      form:,
      association_name: :environment_variables,
      model_class: Service::Form::EnvironmentVariableForm,
      child_component: Services::EnvironmentVariableComponent,
      ) do |component| %>
      <%= component.with_label do %>
        Do not put sensitive values here. Sensitive values should be stored in secrets.
      <% end %>
    <% end %>

    <%= render UI::FormMultiFieldComponent.new(
      title: 'Secrets',
      form:,
      association_name: :secrets,
      model_class: Service::Form::SecretForm,
      child_component: Services::SecretComponent,
    ) do |component| %>
      <%= component.with_label do %>
        Client provided secrets. Use for sensitive values like API keys, passwords, etc.
      <% end %>
    <% end %>

    <%= render UI::FormTextFieldComponent.new(title: 'Predeploy Command') do |component| %>
      <%= component.with_label do %>
        Command to run before deploying the service. For example, database migrations.
      <% end %>
      <%= component.with_field do %>
        <div class="flex items-center gap-2">
          <span class="text-sm">$</span>
          <%= form.text_field :predeploy_command,
                              placeholder: 'rake db:migrate',
                              class: 'w-full !p-0 border-0 focus:ring-0' %>
        </div>
      <% end %>
    <% end %>

    <hr class="border-stone-300 my-2">

    <%= render Services::FormDiskComponent.new(form:, options: Service::Form::MOUNT_DISK_OPTIONS) %>

    <hr class="border-stone-300 my-2">

    <%= render UI::FormMultiFieldComponent.new(
      title: 'Open Ports',
      form:,
      association_name: :ports,
      model_class: Service::Form::PortForm,
      child_component: Services::PortComponent,
      ) do |component| %>
      <%= component.with_label do %>
        Optional open ports for the service. Leave empty if not needed.
      <% end %>
    <% end %>

    <%= form.submit update_create_text, class: 'px-3 py-2 mt-2 bg-stone-700 rounded-md text-stone-100 cursor-pointer w-fit' %>
  </div>
<% end %>
